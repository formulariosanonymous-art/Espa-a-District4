<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espa√±a District | Pro Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff8a00;
            --gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --bg: #f0f2f5;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: #1a1a1a; }

        /* HEADER */
        .header-controls { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .menu-icon { background: var(--white); width: 50px; height: 50px; border-radius: 15px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow); cursor: pointer; border: none; font-size: 24px; }

        /* SIDEBAR */
        .sidebar { position: fixed; right: -320px; top: 0; width: 300px; height: 100%; background: var(--white); z-index: 999; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 60px 25px; box-shadow: -10px 0 30px rgba(0,0,0,0.1); }
        .sidebar.open { right: 0; }
        .nav-item { display: flex; align-items: center; gap: 15px; padding: 15px; border-radius: 12px; margin-bottom: 10px; font-weight: 600; cursor: pointer; color: #555; transition: 0.3s; }
        .nav-item.active { background: #eef2ff; color: #2575fc; }

        /* VISTAS */
        .view { display: none; flex-direction: column; align-items: center; padding: 40px 20px; animation: fadeIn 0.3s ease; min-height: 100vh; box-sizing: border-box; }
        .view.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* BUSCADOR */
        .search-input { width: 100%; max-width: 450px; padding: 18px; border-radius: 20px; border: none; box-shadow: var(--shadow); font-size: 15px; margin-bottom: 25px; outline: none; }

        /* BOTONES DE SECCI√ìN CON COLORES */
        .section-button { 
            width: 100%; max-width: 450px; border: none; padding: 22px; 
            border-radius: 20px; margin-bottom: 12px; display: flex; justify-content: space-between; 
            align-items: center; cursor: pointer; box-shadow: var(--shadow); transition: 0.3s;
            font-size: 17px; font-weight: 800; color: white;
        }
        /* Colores aleatorios por clase */
        .sec-color-0 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #b02e50; }
        .sec-color-1 { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); color: #2e5cb0; }
        .sec-color-2 { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); color: #2eb06e; }
        .sec-color-3 { background: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%); color: #7e2eb0; }

        .norms-container { width: 100%; max-width: 450px; max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }

        /* NORMAS */
        .norm-card { background: white; padding: 20px; border-radius: 20px; margin: 10px 5px 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border-left: 5px solid #2575fc; }
        .norm-img { width: 100%; border-radius: 15px; margin-top: 15px; cursor: pointer; }

        /* EDITOR TOOLS */
        .editor-tools { display: flex; gap: 5px; margin-bottom: 5px; }
        .tool-btn { padding: 5px 10px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; background: white; font-weight: bold; }

        /* ADMIN CARD */
        .admin-card { background: white; padding: 25px; border-radius: 25px; width: 100%; max-width: 500px; box-shadow: var(--shadow); }
        input, textarea, select { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #eee; border-radius: 12px; background: #f9f9f9; font-family: inherit; box-sizing: border-box; }
        .btn-action { width: 100%; padding: 16px; border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; background: #2575fc; margin-top: 10px; }

        /* MODAL */
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center; padding: 20px; }
        #modal img { max-width: 100%; max-height: 90vh; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="header-controls">
        <button class="menu-icon" onclick="toggleSidebar()">‚ò∞</button>
    </div>

    <div id="modal" onclick="this.style.display='none'"><img id="modalImg"></div>

    <div class="sidebar" id="sidebar">
        <h2 style="margin:0">Admin Panel</h2>
        <p style="color:#aaa; font-size:12px;">Espa√±a District v3.0</p>
        <div class="nav-item active" onclick="navigate('home')">üè† Inicio</div>
        <div class="nav-item" onclick="navigate('public')">üìÑ Normativas</div>
        <div class="nav-item" onclick="navigate('login')">‚öôÔ∏è Configuraci√≥n</div>
    </div>

    <section id="view-home" class="view active">
        <img src="https://i.postimg.cc/Jz743TdL/e77730807aec5f2a5360ef9b416e25f7.png" width="150">
        <h1 style="font-size: 40px; font-weight: 800; margin: 10px 0;">District <span style="color:#2575fc">ESP</span></h1>
        <button class="btn-action" style="width:auto; padding: 18px 50px; border-radius: 40px;" onclick="navigate('public')">Entrar a Normas</button>
    </section>

    <section id="view-public" class="view">
        <input type="text" class="search-input" id="search" placeholder="üîç Buscar norma..." onkeyup="renderAll()">
        <div id="content-public" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
    </section>

    <section id="view-admin" class="view">
        <div class="admin-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 id="admin-title">Nueva Secci√≥n</h2>
                <button onclick="cancelEdit()" id="cancel-btn" style="display:none; color:red; border:none; background:none; cursor:pointer;">Cancelar</button>
            </div>
            
            <div id="form-box">
                <div id="sec-form">
                    <input type="text" id="sec-name" placeholder="Nombre de la Secci√≥n">
                    <button class="btn-action" onclick="saveSection()">Guardar Secci√≥n</button>
                </div>
                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                <div id="norm-form">
                    <h3>A√±adir/Editar Norma</h3>
                    <select id="norm-sec-target"></select>
                    <input type="text" id="norm-title" placeholder="T√≠tulo">
                    
                    <div class="editor-tools">
                        <button class="tool-btn" onclick="wrapText('b')">B</button>
                        <button class="tool-btn" onclick="wrapText('i')">I</button>
                        <button class="tool-btn" onclick="wrapText('u')">U</button>
                        <button class="tool-btn" onclick="wrapText('s')">S</button>
                    </div>
                    <textarea id="norm-desc" rows="4" placeholder="Reglas..."></textarea>
                    
                    <label style="font-size:12px; color:#666;">Cargar Foto de Galer√≠a:</label>
                    <input type="file" id="norm-file" accept="image/*">
                    <button class="btn-action" style="background:#2ecc71" onclick="saveNorma()">Guardar Norma</button>
                </div>
            </div>
        </div>
        
        <div id="admin-list" style="width:100%; max-width:500px; margin-top:30px;"></div>
    </section>

    <div id="view-login" class="view" style="background:white; display:none; justify-content:center;">
        <div class="admin-card" style="text-align:center;">
            <h2>Staff Login</h2>
            <input type="password" id="pass" placeholder="Contrase√±a">
            <button class="btn-action" onclick="login()">Acceder</button>
        </div>
    </div>

    <script>
        const WEBHOOK = "https://discord.com/api/webhooks/1474271939697705111/beTyfVivPaHokNQvnPw5SSkaY74Yb6C1SCKBNpj-SM2EfXBBhNT-YtvlecFYCkl4vAR4";
        let db = JSON.parse(localStorage.getItem('esp_db')) || [];
        let editing = { sIdx: null, nIdx: null };

        function save() { 
            localStorage.setItem('esp_db', JSON.stringify(db)); 
            renderAll(); 
            renderAdmin(); 
        }

        async function log(msg) {
            fetch(WEBHOOK, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ content: `**Espa√±a District Log:** ${msg}` })});
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

        function navigate(v) {
            document.querySelectorAll('.view').forEach(s => s.classList.remove('active'));
            document.getElementById('view-login').style.display = 'none';
            if(v === 'login' && !sessionStorage.getItem('admin')) {
                document.getElementById('view-login').style.display = 'flex';
            } else {
                document.getElementById('view-' + (v==='login'?'admin':v)).classList.add('active');
            }
            toggleSidebar();
            renderAll();
            renderAdmin();
        }

        function login() {
            if(document.getElementById('pass').value === "pampiano17") {
                sessionStorage.setItem('admin', true);
                navigate('admin');
            } else alert("Error");
        }

        // EDITOR TOOLS
        function wrapText(tag) {
            const area = document.getElementById('norm-desc');
            const start = area.selectionStart;
            const end = area.selectionEnd;
            const text = area.value;
            area.value = text.substring(0, start) + `<${tag}>` + text.substring(start, end) + `</${tag}>` + text.substring(end);
        }

        // IMAGEN A BASE64
        function getBase64(file) {
            return new Promise((res, rej) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => res(reader.result);
                reader.onerror = e => rej(e);
            });
        }

        // GUARDAR SECCION
        function saveSection() {
            const name = document.getElementById('sec-name').value;
            if(!name) return;
            if(editing.sIdx !== null && editing.nIdx === null) {
                db[editing.sIdx].name = name;
                log(`Secci√≥n editada: ${name}`);
            } else {
                db.push({ name, norms: [] });
                log(`Secci√≥n creada: ${name}`);
            }
            cancelEdit();
            save();
        }

        // GUARDAR NORMA
        async function saveNorma() {
            const sIdx = document.getElementById('norm-sec-target').value;
            const title = document.getElementById('norm-title').value;
            const desc = document.getElementById('norm-desc').value;
            const file = document.getElementById('norm-file').files[0];
            let img = editing.sIdx !== null && editing.nIdx !== null ? db[editing.sIdx].norms[editing.nIdx].img : "";

            if(file) img = await getBase64(file);

            if(editing.sIdx !== null && editing.nIdx !== null) {
                db[editing.sIdx].norms[editing.nIdx] = { title, desc, img };
                log(`Norma editada: ${title}`);
            } else {
                db[sIdx].norms.push({ title, desc, img });
                log(`Norma a√±adida: ${title}`);
            }
            cancelEdit();
            save();
        }

        function editItem(s, n = null) {
            editing = { sIdx: s, nIdx: n };
            document.getElementById('cancel-btn').style.display = 'block';
            if(n === null) {
                document.getElementById('sec-name').value = db[s].name;
            } else {
                document.getElementById('norm-sec-target').value = s;
                document.getElementById('norm-title').value = db[s].norms[n].title;
                document.getElementById('norm-desc').value = db[s].norms[n].desc;
            }
            window.scrollTo(0,0);
        }

        function cancelEdit() {
            editing = { sIdx: null, nIdx: null };
            document.getElementById('sec-name').value = "";
            document.getElementById('norm-title').value = "";
            document.getElementById('norm-desc').value = "";
            document.getElementById('norm-file').value = "";
            document.getElementById('cancel-btn').style.display = 'none';
        }

        function deleteItem(s, n = null) {
            if(confirm("¬øSeguro?")) {
                if(n === null) db.splice(s, 1);
                else db[s].norms.splice(n, 1);
                save();
            }
        }

        function toggleSection(idx) {
            const el = document.getElementById('sec-' + idx);
            const isOpen = el.style.maxHeight !== '0px';
            document.querySelectorAll('.norms-container').forEach(c => c.style.maxHeight = '0px');
            if(!isOpen) el.style.maxHeight = '2000px';
        }

        function renderAdmin() {
            const list = document.getElementById('admin-list');
            const select = document.getElementById('norm-sec-target');
            if(!list) return;

            list.innerHTML = "<h3>Gesti√≥n Actual</h3>";
            select.innerHTML = "";
            
            db.forEach((s, sIdx) => {
                select.innerHTML += `<option value="${sIdx}">${s.name}</option>`;
                list.innerHTML += `
                    <div class="list-item" style="border-left: 5px solid #2575fc">
                        <b>${s.name}</b>
                        <div>
                            <button onclick="editItem(${sIdx})">‚úèÔ∏è</button>
                            <button onclick="deleteItem(${sIdx})">üóëÔ∏è</button>
                        </div>
                    </div>`;
                s.norms.forEach((n, nIdx) => {
                    list.innerHTML += `
                        <div class="list-item" style="margin-left:25px; font-size:13px; background:#f0f0f0;">
                            <span>${nIdx+1}. ${n.title}</span>
                            <div>
                                <button onclick="editItem(${sIdx}, ${nIdx})">‚úèÔ∏è</button>
                                <button onclick="deleteItem(${sIdx}, ${nIdx})">üóëÔ∏è</button>
                            </div>
                        </div>`;
                });
            });
        }

        function renderAll() {
            const cont = document.getElementById('content-public');
            const q = document.getElementById('search').value.toLowerCase();
            if(!cont) return;
            cont.innerHTML = "";

            db.forEach((s, i) => {
                const filtered = s.norms.filter(n => n.title.toLowerCase().includes(q) || n.desc.toLowerCase().includes(q));
                if(s.name.toLowerCase().includes(q) || filtered.length > 0) {
                    const colorClass = `sec-color-${i % 4}`;
                    cont.innerHTML += `
                        <button class="section-button ${colorClass}" onclick="toggleSection(${i})">
                            ${s.name} <span>‚ñº</span>
                        </button>
                        <div class="norms-container" id="sec-${i}" style="max-height:0px">
                            ${filtered.map((n, ni) => `
                                <div class="norm-card">
                                    <div style="display:flex; align-items:center; margin-bottom:10px;">
                                        <span style="background:#2575fc; color:white; width:25px; height:25px; display:flex; align-items:center; justify-content:center; border-radius:5px; margin-right:10px; font-size:12px; font-weight:bold;">${s.norms.indexOf(n)+1}</span>
                                        <b style="font-size:16px;">${n.title}</b>
                                    </div>
                                    <div style="font-size:14px; color:#444; line-height:1.6;">${n.desc}</div>
                                    ${n.img ? `<img src="${n.img}" class="norm-img" onclick="showImg('${n.img}')">` : ''}
                                </div>
                            `).join('')}
                        </div>`;
                }
            });
        }

        function showImg(src) {
            document.getElementById('modalImg').src = src;
            document.getElementById('modal').style.display = 'flex';
        }

        renderAll();
        renderAdmin();
    </script>
</body>
</html>
