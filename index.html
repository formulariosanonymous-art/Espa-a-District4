<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espa√±a District | Elite System</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0b101b; --primary: #5865f2; --norms: #a855f7; --gov: #f59e0b; --card: #161c2d; --text: #f1f5f9; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); }

        /* HEADER & SIDEBAR */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; position: fixed; top: 0; width: 100%; box-sizing: border-box; background: rgba(11, 16, 27, 0.95); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .sidebar { position: fixed; top: 0; right: -100%; width: 280px; height: 100%; background: var(--card); z-index: 2000; transition: 0.4s; padding: 60px 20px; box-shadow: -10px 0 30px rgba(0,0,0,0.5); }
        .sidebar.open { right: 0; }
        .sidebar-link { display: block; padding: 15px; color: white; text-decoration: none; font-weight: 600; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }

        /* VISTAS */
        .view { display: none; flex-direction: column; align-items: center; padding: 100px 20px 40px; min-height: 100vh; box-sizing: border-box; }
        .view.active { display: flex; animation: fadeIn 0.3s ease; }

        /* ACORDEONES */
        .accordion { width: 100%; max-width: 700px; margin-bottom: 15px; background: var(--card); border-radius: 15px; overflow: hidden; border-left: 5px solid var(--primary); }
        .acc-header { padding: 20px; cursor: pointer; font-weight: 800; display: flex; justify-content: space-between; background: rgba(255,255,255,0.02); }
        .acc-content { max-height: 0; overflow: hidden; transition: 0.4s ease; }
        .accordion.open .acc-content { max-height: 10000px; padding: 10px 0; }
        
        .norm-item { margin: 10px 20px; padding: 20px; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); position: relative; }
        .norm-num { position: absolute; top: 10px; right: 15px; color: var(--primary); font-weight: 800; font-size: 12px; }

        /* BOTONES */
        .btn { border: none; border-radius: 10px; color: white; padding: 12px 20px; font-weight: 700; cursor: pointer; transition: 0.3s; margin: 5px; font-size: 13px; }
        .btn-purple { background: linear-gradient(to right, #7c3aed, #2563eb); }
        .btn-sec { background: #334155; }

        /* ADMIN BOXES */
        .admin-box { width: 100%; max-width: 600px; background: var(--card); padding: 25px; border-radius: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; background: #0b101b; border: 1px solid #334155; color: white; box-sizing: border-box; }
        
        .overlay { position: fixed; inset: 0; background: var(--bg); z-index: 3000; display: none; align-items: center; justify-content: center; flex-direction: column; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="sidebar" class="sidebar">
        <span style="float:right; cursor:pointer;" onclick="toggleSide()">√ó</span>
        <div class="sidebar-link" onclick="goTo('home')">üè† Inicio</div>
        <div class="sidebar-link" onclick="goTo('norms')">üìú Normativas</div>
        <div class="sidebar-link" onclick="goTo('gov')">üèõÔ∏è Gobierno</div>
        <div class="sidebar-link" onclick="openLogin()" style="color:var(--gov); border-top:1px solid #333; margin-top:20px;">‚öôÔ∏è CONFIGURACI√ìN STAFF</div>
    </div>

    <header class="header">
        <div id="cfg-nav-title" style="font-weight: 900; letter-spacing: 1px;">ESPA√ëA DISTRICT</div>
        <div style="cursor:pointer; font-size: 24px;" onclick="toggleSide()">‚ò∞</div>
    </header>

    <section id="view-home" class="view active">
        <div style="width:110px; height:110px; border-radius:25px; background:linear-gradient(135deg, var(--norms), var(--primary)); display:flex; align-items:center; justify-content:center; margin-bottom:20px; box-shadow: 0 0 30px rgba(88,101,242,0.3); overflow:hidden;">
            <img id="display-logo" src="https://i.imgur.com/M6L7i7l.png" style="width:100%; height:100%; object-fit:cover;">
        </div>
        <h1 id="display-title" style="font-size: 35px; margin: 0;">Espa√±a District</h1>
        <p id="display-desc" style="color: #94a3b8; text-align: center; max-width: 400px;">Portal de leyes y servicios gubernamentales.</p>
        <input type="text" style="width:100%; max-width:500px; padding:15px; border-radius:12px; background:var(--card); border:1px solid var(--primary); color:white; margin:20px 0;" placeholder="Buscar normas..." onkeyup="globalSearch(this.value)">
        <div style="display:flex; gap:10px;"><button class="btn btn-purple" onclick="goTo('norms')">Normativas</button><button class="btn btn-purple" style="background:var(--gov)" onclick="goTo('gov')">Gobierno</button></div>
    </section>

    <section id="view-norms" class="view"><h2>üìú Normativas</h2><div id="render-norms" style="width:100%;"></div></section>
    <section id="view-gov" class="view"><h2>üèõÔ∏è Gobierno</h2><div id="render-gov" style="width:100%;"></div></section>

    <section id="view-admin" class="view">
        <div id="staff-tag" style="background:var(--primary); padding:6px 15px; border-radius:20px; font-size:11px; font-weight:800; margin-bottom:20px;">CARGANDO STAFF...</div>
        
        <div style="display:flex; gap:5px; margin-bottom:20px; overflow-x:auto; width:100%; max-width:700px; padding:5px;">
            <button class="btn btn-purple" onclick="tab('t-norms')">Edit Normas</button>
            <button class="btn btn-purple" style="background:var(--gov)" onclick="tab('t-gov')">Edit Gobierno</button>
            <button class="btn btn-sec" onclick="tab('t-design')">Dise√±o Web</button>
            <button class="btn btn-sec" onclick="protectedTab('t-hooks')">Webhooks üîí</button>
            <button class="btn btn-sec" onclick="protectedTab('t-pass')">Seguridad üîí</button>
            <button class="btn" style="background:#ef4444" onclick="location.reload()">Cerrar</button>
        </div>

        <div id="t-norms" class="admin-box">
            <h3 style="color:var(--norms)">Gesti√≥n de Normativas</h3>
            <input type="text" id="add-cat-norms" placeholder="Nueva Secci√≥n de Normas (Ej: C√≥digo Penal)">
            <button class="btn btn-purple" style="width:100%" onclick="addCat('norms')">Crear Secci√≥n Normativa</button>
            <hr style="opacity:0.1; margin:20px 0">
            <select id="dest-norms"></select>
            <input type="text" id="item-title-norms" placeholder="T√≠tulo de la Norma">
            <textarea id="item-desc-norms" rows="3" placeholder="Descripci√≥n..."></textarea>
            <input type="file" id="item-file-norms" accept="image/*">
            <button class="btn btn-purple" style="width:100%" onclick="addItem('norms')">Publicar en Normativa</button>
            <div id="manage-norms" style="margin-top:20px"></div>
        </div>

        <div id="t-gov" class="admin-box" style="display:none">
            <h3 style="color:var(--gov)">Gesti√≥n de Gobierno</h3>
            <input type="text" id="add-cat-gov" placeholder="Nueva Secci√≥n Gobierno (Ej: LSPD)">
            <button class="btn btn-purple" style="background:var(--gov); width:100%" onclick="addCat('gov')">Crear Secci√≥n Gobierno</button>
            <hr style="opacity:0.1; margin:20px 0">
            <select id="dest-gov"></select>
            <input type="text" id="item-title-gov" placeholder="T√≠tulo">
            <textarea id="item-desc-gov" rows="3" placeholder="Descripci√≥n..."></textarea>
            <input type="file" id="item-file-gov" accept="image/*">
            <button class="btn btn-purple" style="background:var(--gov); width:100%" onclick="addItem('gov')">Publicar en Gobierno</button>
            <div id="manage-gov" style="margin-top:20px"></div>
        </div>

        <div id="t-design" class="admin-box" style="display:none">
            <h3>Dise√±o General</h3>
            <label>T√≠tulo:</label><input type="text" id="cfg-title">
            <label>Descripci√≥n:</label><input type="text" id="cfg-desc">
            <label>Logo:</label><input type="file" id="cfg-logo-file">
            <button class="btn btn-purple" style="width:100%" onclick="saveDesign()">Guardar Cambios</button>
        </div>

        <div id="t-hooks" class="admin-box" style="display:none">
            <h3 style="color:var(--norms)">Configuraci√≥n Webhook</h3>
            <input type="text" id="cfg-hook" placeholder="URL Webhook Discord">
            <button class="btn btn-purple" style="width:100%" onclick="saveHook()">Vincular</button>
        </div>

        <div id="t-pass" class="admin-box" style="display:none">
            <h3>Seguridad y Perfil</h3>
            <label>Tu Nombre:</label><input type="text" id="cfg-s-name">
            <label>Tu Rango:</label><input type="text" id="cfg-s-range">
            <label>Nueva Contrase√±a Maestra:</label><input type="password" id="cfg-pass" placeholder="Nueva clave">
            <button class="btn btn-purple" style="width:100%" onclick="saveSecurity()">Actualizar Datos</button>
        </div>
    </section>

    <div id="login" class="overlay">
        <div class="admin-box" style="max-width:320px; text-align:center;">
            <h2>Staff Access</h2>
            <input type="password" id="pass-input" placeholder="Clave Maestra" style="text-align:center;">
            <button class="btn btn-purple" style="width:100%" onclick="checkLogin()">Entrar al Panel</button>
            <p onclick="closeLogin()" style="cursor:pointer; opacity:0.5; margin-top:10px;">Volver</p>
        </div>
    </div>

    <div id="second-login" class="overlay">
        <div class="admin-box" style="max-width:300px; text-align:center;">
            <h3>Confirmar Identidad</h3>
            <input type="password" id="pass-second" placeholder="Contrase√±a">
            <button class="btn btn-purple" style="width:100%" onclick="verifyProtected()">Confirmar</button>
            <p onclick="this.parentElement.parentElement.style.display='none'" style="cursor:pointer; opacity:0.5">Cerrar</p>
        </div>
    </div>

    <script>
        let cfg = JSON.parse(localStorage.getItem('ed_cfg_v3')) || {
            title: "Espa√±a District", desc: "Portal de leyes y servicios gubernamentales.",
            logo: "https://i.imgur.com/M6L7i7l.png", pass: "pampiano17",
            staffName: "Admin", staffRange: "Fundador", hook: ""
        };
        let db = JSON.parse(localStorage.getItem('ed_db_v3')) || { norms: [], gov: [] };
        let pendingTab = "";

        function save() { 
            localStorage.setItem('ed_cfg_v3', JSON.stringify(cfg)); 
            localStorage.setItem('ed_db_v3', JSON.stringify(db)); 
            render(); 
        }

        async function sendLog(title, desc) {
            if(!cfg.hook) return;
            await fetch(cfg.hook, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ embeds: [{ 
                    title: title, 
                    description: desc, 
                    color: 3447003, 
                    fields: [{name: "Staff", value: cfg.staffName, inline: true}, {name: "Rango", value: cfg.staffRange, inline: true}],
                    timestamp: new Date() 
                }] })
            });
        }

        function toggleSide() { document.getElementById('sidebar').classList.toggle('open'); }
        function goTo(id) { 
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            if(document.getElementById('sidebar').classList.contains('open')) toggleSide();
        }

        function tab(id) {
            document.querySelectorAll('.admin-box').forEach(b => { if(b.id && b.id.startsWith('t-')) b.style.display='none'; });
            document.getElementById(id).style.display='block';
        }

        function protectedTab(id) { pendingTab = id; document.getElementById('second-login').style.display='flex'; }
        function verifyProtected() {
            if(document.getElementById('pass-second').value === cfg.pass) {
                document.getElementById('second-login').style.display='none';
                document.getElementById('pass-second').value = "";
                tab(pendingTab);
            } else { alert("Incorrecto"); }
        }

        function openLogin() { toggleSide(); document.getElementById('login').style.display='flex'; }
        function closeLogin() { document.getElementById('login').style.display='none'; }
        
        function checkLogin() {
            if(document.getElementById('pass-input').value === cfg.pass) {
                closeLogin(); goTo('admin');
                document.getElementById('staff-tag').innerText = `${cfg.staffName.toUpperCase()} (${cfg.staffRange.toUpperCase()})`;
                sendLog("üì• Acceso al Panel", `El miembro del staff ha iniciado sesi√≥n en el √°rea de gesti√≥n.`);
            } else { alert("Clave Err√≥nea"); }
        }

        function addCat(type) {
            const val = document.getElementById('add-cat-' + type).value;
            if(val) { db[type].push({ name: val, items: [] }); save(); sendLog("üìÅ Nueva Secci√≥n", `Se cre√≥ la secci√≥n **${val}** en ${type.toUpperCase()}`); document.getElementById('add-cat-' + type).value=""; }
        }

        function addItem(type) {
            const dest = document.getElementById('dest-' + type).value;
            const t = document.getElementById('item-title-' + type).value;
            const d = document.getElementById('item-desc-' + type).value;
            const f = document.getElementById('item-file-' + type).files[0];
            if(!t || !d) return;
            const done = (img) => { 
                db[type][dest].items.push({ title: t, desc: d, img }); 
                save(); sendLog("üìù Nuevo √çtem", `Publicado: **${t}** en la secci√≥n **${db[type][dest].name}**`);
                document.getElementById('item-title-' + type).value=""; document.getElementById('item-desc-' + type).value="";
            };
            if(f) { const r = new FileReader(); r.onload = (e) => done(e.target.result); r.readAsDataURL(f); } else { done(null); }
        }

        function saveDesign() {
            cfg.title = document.getElementById('cfg-title').value;
            cfg.desc = document.getElementById('cfg-desc').value;
            const f = document.getElementById('cfg-logo-file').files[0];
            if(f) { const r = new FileReader(); r.onload = (e) => { cfg.logo = e.target.result; save(); }; r.readAsDataURL(f); } else { save(); }
            alert("Dise√±o guardado");
        }

        function saveHook() { cfg.hook = document.getElementById('cfg-hook').value; save(); alert("Viculado"); }

        function saveSecurity() {
            if(document.getElementById('cfg-pass').value) cfg.pass = document.getElementById('cfg-pass').value;
            cfg.staffName = document.getElementById('cfg-s-name').value;
            cfg.staffRange = document.getElementById('cfg-s-range').value;
            save(); alert("Seguridad Actualizada");
        }

        function delI(t, ci, ii) { if(confirm("¬øBorrar?")) { db[t][ci].items.splice(ii,1); save(); } }
        function delC(t, ci) { if(confirm("¬øBorrar secci√≥n?")) { db[t].splice(ci,1); save(); } }

        function render() {
            document.getElementById('display-title').innerText = cfg.title;
            document.getElementById('cfg-nav-title').innerText = cfg.title;
            document.getElementById('display-desc').innerText = cfg.desc;
            document.getElementById('display-logo').src = cfg.logo;
            document.getElementById('cfg-title').value = cfg.title;
            document.getElementById('cfg-desc').value = cfg.desc;
            document.getElementById('cfg-s-name').value = cfg.staffName;
            document.getElementById('cfg-s-range').value = cfg.staffRange;
            document.getElementById('cfg-hook').value = cfg.hook;

            ['norms', 'gov'].forEach(type => {
                const renderCont = document.getElementById('render-' + type);
                const destSelect = document.getElementById('dest-' + type);
                const manageCont = document.getElementById('manage-' + type);
                renderCont.innerHTML = ""; destSelect.innerHTML = ""; manageCont.innerHTML = "";

                db[type].forEach((cat, ci) => {
                    destSelect.innerHTML += `<option value="${ci}">${cat.name}</option>`;
                    let itemsHtml = cat.items.map((it, ii) => `
                        <div class="norm-item">
                            <span class="norm-num">#${ii+1}</span>
                            <h3>${it.title}</h3><p style="white-space:pre-line">${it.desc}</p>
                            ${it.img ? `<img src="${it.img}" style="width:100%; border-radius:10px; margin-top:10px;">` : ''}
                        </div>`).join('');

                    const color = type==='norms'?'var(--norms)':'var(--gov)';
                    renderCont.innerHTML += `<div class="accordion" style="border-left-color:${color}"><div class="acc-header" onclick="this.parentElement.classList.toggle('open')">${cat.name} <span>‚ñº</span></div><div class="acc-content">${itemsHtml || '<p style="padding:20px">Vacio</p>'}</div></div>`;

                    manageCont.innerHTML += `<div style="background:#0b101b; padding:12px; border-radius:10px; margin-top:10px;">
                        <b>${cat.name}</b> <span onclick="delC('${type}',${ci})" style="float:right; color:red; cursor:pointer">Eliminar</span>
                        ${cat.items.map((it, ii) => `<div style="font-size:11px; opacity:0.6; margin-top:5px;">${it.title} <span onclick="delI('${type}',${ci},${ii})" style="color:red; cursor:pointer">(X)</span></div>`).join('')}
                    </div>`;
                });
            });
        }

        function globalSearch(q) {
            if(q.length < 2) return;
            goTo('norms');
            document.querySelectorAll('.accordion').forEach(acc => {
                const has = acc.innerText.toLowerCase().includes(q.toLowerCase());
                acc.style.display = has ? 'block' : 'none';
                if(has) acc.classList.add('open');
            });
        }
        window.onload = render;
    </script>
</body>
</html>
