<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espa√±a District | Sistema de Normas</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2575fc;
            --success: #2ecc71;
            --danger: #ff4d4d;
            --bg: #f4f7fa;
            --white: #ffffff;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
            --gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        }

        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: #333; overflow-x: hidden; }

        /* HEADER */
        .header { position: fixed; top: 0; width: 100%; height: 70px; background: var(--white); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-sizing: border-box; z-index: 100; box-shadow: var(--shadow); }
        .menu-icon { background: #f0f2f5; width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; font-size: 20px; }

        /* SIDEBAR */
        .sidebar { position: fixed; right: -320px; top: 0; width: 280px; height: 100%; background: var(--white); z-index: 999; transition: 0.4s; padding: 25px 20px; box-shadow: -5px 0 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; }
        .sidebar.open { right: 0; }
        .nav-item { padding: 15px; border-radius: 12px; margin-bottom: 8px; cursor: pointer; font-weight: 600; color: #666; display: flex; align-items: center; gap: 12px; transition: 0.3s; }
        .nav-item:hover { background: #f8faff; color: var(--primary); }
        .sidebar-footer { border-top: 1px solid #eee; padding-top: 15px; margin-bottom: 10px; }
        .info-box { background: #5865F2; color: white; padding: 12px; border-radius: 12px; text-decoration: none; display: flex; flex-direction: column; gap: 2px; }

        /* LOGIN SCREEN (Basada en imagen 1000108042) */
        #login-screen { position: fixed; inset: 0; background: var(--gradient); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .login-card { background: white; padding: 40px 30px; border-radius: 25px; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .login-icon { background: #fff1e6; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 35px; color: #ff8a00; border: 4px solid white; box-shadow: var(--shadow); }

        /* VISTAS */
        .view { display: none; flex-direction: column; align-items: center; padding: 90px 20px 40px; min-height: 100vh; box-sizing: border-box; animation: fadeIn 0.3s ease; }
        .view.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ADMIN COMPONENTS */
        .admin-tabs { display: flex; background: #eee; padding: 5px; border-radius: 12px; margin-bottom: 25px; width: 100%; max-width: 500px; }
        .tab-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; background: none; color: #777; }
        .tab-btn.active { background: var(--white); color: var(--primary); box-shadow: var(--shadow); }

        .card { background: var(--white); padding: 25px; border-radius: 20px; width: 100%; max-width: 500px; box-shadow: var(--shadow); margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #eee; border-radius: 12px; background: #fafafa; font-family: inherit; box-sizing: border-box; outline: none; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-add { background: var(--success); color: white; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-gradient { background: linear-gradient(to right, #ff8a00, #ff4d4d); color: white; }

        .list-item { background: #f9f9f9; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <div class="login-icon">üîí</div>
            <h2 style="margin: 0 0 5px;">Admin Panel</h2>
            <p style="font-size: 13px; color: #777; margin-bottom: 25px;">Espa√±a District - Acceso Administrativo</p>
            <input type="password" id="admin-pass" placeholder="Ingresa la contrase√±a">
            <button class="btn btn-gradient" onclick="checkPass()" style="margin-top: 15px;">Acceder</button>
            <p onclick="navigate('home'); document.getElementById('login-screen').style.display='none';" style="margin-top:20px; font-size:12px; color:var(--primary); cursor:pointer; font-weight:600;">Volver al Inicio</p>
        </div>
    </div>

    <header class="header">
        <div style="font-weight: 800; font-size: 18px;">Espa√±a <span style="color:var(--primary)">District</span></div>
        <button class="menu-icon" onclick="toggleSidebar()">‚ò∞</button>
    </header>

    <div class="sidebar" id="sidebar">
        <div>
            <h2 style="margin:0; color:var(--primary); font-size: 22px;">Navegaci√≥n</h2>
            <div class="nav-item" onclick="navigate('home')">üè† Inicio</div>
            <div class="nav-item" onclick="navigate('public')">üìÑ Ver Normas</div>
            <div class="nav-item" onclick="openAdmin()">‚öôÔ∏è Panel Admin</div>
        </div>

        <div class="sidebar-footer">
            <p style="margin: 0 0 8px 5px; font-weight: 700; color: #999; font-size: 11px; text-transform: uppercase;">Informaci√≥n</p>
            <a href="https://discord.gg/Rp5fumwpUK" target="_blank" class="info-box">
                <span style="font-weight: 800; font-size: 13px;">Servidor de Discord</span>
                <span style="font-size: 10px; opacity: 0.8;">Click para unirte</span>
            </a>
        </div>
    </div>

    <section id="view-home" class="view active">
        <img src="https://i.postimg.cc/Jz743TdL/e77730807aec5f2a5360ef9b416e25f7.png" width="120" style="margin-bottom:20px;">
        <h1 style="font-size: 32px; margin:0;">Espa√±a District</h1>
        <p style="color:#666; margin-bottom:30px;">Bienvenid@ a las normas del servidor</p>
        <button class="btn btn-primary" style="width:auto; padding: 15px 40px; border-radius: 30px;" onclick="navigate('public')">Ver Normas ‚Üí</button>
    </section>

    <section id="view-public" class="view">
        <input type="text" id="search" placeholder="üîç Buscar norma..." onkeyup="renderPublic()" style="max-width:500px; box-shadow: var(--shadow); border:none;">
        <div id="public-content" style="width:100%; max-width:500px;"></div>
    </section>

    <section id="view-admin" class="view">
        <div style="display:flex; justify-content:space-between; width:100%; max-width:500px; align-items:center; margin-bottom:20px;">
            <h2 style="margin:0;">Panel Admin</h2>
            <button onclick="logoutAdmin()" style="border:none; color:var(--danger); background:none; font-weight:700; cursor:pointer;">Cerrar Sesi√≥n</button>
        </div>
        
        <div class="admin-tabs">
            <button class="tab-btn active" onclick="switchTab('tab-sec', this)">Secciones</button>
            <button class="tab-btn" onclick="switchTab('tab-norm', this)">Normas</button>
            <button class="tab-btn" onclick="switchTab('tab-conf', this)">Configuraci√≥n</button>
        </div>

        <div id="tab-sec" class="admin-tab-content" style="width:100%; display:flex; flex-direction:column; align-items:center;">
            <div class="card">
                <h3>Crear Nueva Secci√≥n</h3>
                <input type="text" id="sec-name" placeholder="Ej: Normas de Convivencia">
                <button class="btn btn-add" id="sec-btn" onclick="saveSection()">+ Agregar Secci√≥n</button>
            </div>
            <div class="card">
                <h3>Secciones Existentes</h3>
                <div id="list-sections"></div>
            </div>
        </div>

        <div id="tab-norm" class="admin-tab-content" style="width:100%; display:none; flex-direction:column; align-items:center;">
            <div class="card">
                <h3>Crear Nueva Norma</h3>
                <select id="norm-target"></select>
                <input type="text" id="norm-title" placeholder="T√≠tulo">
                <textarea id="norm-desc" rows="4" placeholder="Descripci√≥n..."></textarea>
                <input type="file" id="norm-file" accept="image/*">
                <button class="btn btn-primary" id="norm-btn" onclick="saveNorma()">+ Guardar Norma</button>
            </div>
            <div class="card">
                <h3>Lista de Normas</h3>
                <div id="list-norms"></div>
            </div>
        </div>

        <div id="tab-conf" class="admin-tab-content" style="width:100%; display:none; flex-direction:column; align-items:center;">
            <div class="card" style="text-align:center;">
                <h3>Configuraci√≥n Visual</h3>
                <img id="current-logo" src="https://i.postimg.cc/Jz743TdL/e77730807aec5f2a5360ef9b416e25f7.png" width="80" style="margin-bottom:15px;">
                <input type="text" id="config-logo-url" placeholder="URL del logo">
                <button class="btn btn-primary" onclick="updateConfig()">Actualizar Logo</button>
            </div>
        </div>
    </section>

    <script>
        const WEBHOOK = "https://discord.com/api/webhooks/1474271939697705111/beTyfVivPaHokNQvnPw5SSkaY74Yb6C1SCKBNpj-SM2EfXBBhNT-YtvlecFYCkl4vAR4";
        const ADMIN_PASS = "pampiano17"; // CAMBIA TU CONTRASE√ëA AQU√ç
        let db = JSON.parse(localStorage.getItem('esp_v6')) || [];
        let editIdx = { s: null, n: null };

        // SISTEMA DE SEGURIDAD
        function openAdmin() {
            document.getElementById('login-screen').style.display = 'flex';
            toggleSidebar();
        }

        function checkPass() {
            const val = document.getElementById('admin-pass').value;
            if(val === ADMIN_PASS) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-pass').value = "";
                navigate('admin');
            } else {
                alert("Contrase√±a incorrecta");
            }
        }

        function logoutAdmin() {
            navigate('home');
        }

        // LOGS DISCORD
        async function discordLog(title, desc, color) {
            const embed = { title: title, description: desc, color: color || 3447003, timestamp: new Date() };
            fetch(WEBHOOK, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ embeds: [embed] }) });
        }

        function save() { 
            localStorage.setItem('esp_v6', JSON.stringify(db)); 
            renderAll(); 
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

        function navigate(v) {
            document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
        }

        function switchTab(tabId, btn) {
            document.querySelectorAll('.admin-tab-content').forEach(t => t.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).style.display = 'flex';
            btn.classList.add('active');
        }

        // FUNCIONES DE DATOS
        function saveSection() {
            const name = document.getElementById('sec-name').value;
            if(!name) return;
            db.push({ name, norms: [] });
            discordLog("üìÅ Nueva Secci√≥n", `Nombre: **${name}**`, 3066993);
            document.getElementById('sec-name').value = "";
            save();
        }

        async function saveNorma() {
            const sIdx = document.getElementById('norm-target').value;
            const title = document.getElementById('norm-title').value;
            const desc = document.getElementById('norm-desc').value;
            const file = document.getElementById('norm-file').files[0];
            
            const finalize = (img) => {
                db[sIdx].norms.push({ title, desc, img });
                discordLog("‚úÖ Nueva Norma", `T√≠tulo: **${title}**\nEn: **${db[sIdx].name}**`, 3447003);
                save();
                document.getElementById('norm-title').value = "";
                document.getElementById('norm-desc').value = "";
            };

            if(file) {
                const reader = new FileReader();
                reader.onload = () => finalize(reader.result);
                reader.readAsDataURL(file);
            } else finalize("");
        }

        function deleteItem(s, n = null) {
            if(!confirm("¬øBorrar?")) return;
            if(n === null) db.splice(s, 1);
            else db[s].norms.splice(n, 1);
            save();
        }

        function renderAll() {
            renderPublic();
            const lSec = document.getElementById('list-sections');
            const lNorm = document.getElementById('list-norms');
            const select = document.getElementById('norm-target');
            lSec.innerHTML = ""; lNorm.innerHTML = ""; select.innerHTML = "";
            db.forEach((s, si) => {
                select.innerHTML += `<option value="${si}">${s.name}</option>`;
                lSec.innerHTML += `<div class="list-item"><b>${s.name}</b><button class="btn-delete" onclick="deleteItem(${si})">üóëÔ∏è</button></div>`;
                s.norms.forEach((n, ni) => {
                    lNorm.innerHTML += `<div class="list-item"><span>${n.title}</span><button class="btn-delete" onclick="deleteItem(${si},${ni})">üóëÔ∏è</button></div>`;
                });
            });
        }

        function renderPublic() {
            const cont = document.getElementById('public-content');
            const q = document.getElementById('search').value.toLowerCase();
            cont.innerHTML = "";
            db.forEach((s, si) => {
                const filtered = s.norms.filter(n => n.title.toLowerCase().includes(q));
                if(filtered.length > 0 || s.name.toLowerCase().includes(q)) {
                    cont.innerHTML += `<div style="background:var(--gradient); color:white; padding:15px; border-radius:12px; margin-top:10px; font-weight:800;">${s.name}</div>`;
                    filtered.forEach(n => {
                        cont.innerHTML += `<div class="card" style="margin-top:10px; border-left:5px solid var(--primary);"><b>${n.title}</b><p>${n.desc}</p>${n.img ? `<img src="${n.img}" style="width:100%; border-radius:10px;">`:''}</div>`;
                    });
                }
            });
        }

        renderAll();
    </script>
</body>
</html>
